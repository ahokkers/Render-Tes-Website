<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pipe Hydraulics Calculator</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: 'Roboto', sans-serif; background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); min-height: 100vh; }
        .container { max-width: 800px; margin-top: 30px; }
        .card { border: none; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); }
        .btn-primary { background: linear-gradient(45deg, #007bff, #0056b3); border: none; }
        .result-box { background: #f8f9fa; border-radius: 10px; padding: 15px; margin-top: 15px; }
        .advanced-toggle { cursor: pointer; color: #007bff; }
        .chart-container { position: relative; height: 300px; width: 100%; }
        footer { text-align: center; margin-top: 30px; color: #6c757d; }
        .history-table { max-height: 200px; overflow-y: auto; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card p-4">
            <h1 class="text-center mb-4"><i class="fas fa-cogs"></i> Pipe Hydraulics Calculator</h1>
            <p class="text-muted text-center">Professional tool for calculating pressure drop due to friction using the Darcy-Weisbach equation.</p>
            <form id="calcForm">
                <div class="row">
                    <div class="col-md-6 mb-3">
                        <label for="L" class="form-label"><i class="fas fa-ruler"></i> Pipe length (m)</label>
                        <input type="number" step="0.01" class="form-control" id="L" value="100" data-bs-toggle="tooltip" title="Total length of the pipe" required>
                    </div>
                    <div class="col-md-6 mb-3">
                        <label for="D" class="form-label"><i class="fas fa-circle"></i> Pipe diameter (m)</label>
                        <input type="number" step="0.01" class="form-control" id="D" value="0.1" data-bs-toggle="tooltip" title="Internal diameter of the pipe" required>
                    </div>
                </div>
                <div class="mb-3">
                    <label for="Q" class="form-label"><i class="fas fa-water"></i> Flow rate (m³/s)</label>
                    <input type="number" step="0.01" class="form-control" id="Q" value="0.01" data-bs-toggle="tooltip" title="Volumetric flow rate of the fluid" required>
                </div>
                <div class="mb-3">
                    <span class="advanced-toggle" onclick="toggleAdvanced()"><i class="fas fa-chevron-down"></i> Show Advanced Options</span>
                </div>
                <div id="advanced" style="display:none;">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="rho" class="form-label"><i class="fas fa-weight"></i> Fluid density (kg/m³)</label>
                            <input type="number" step="0.01" class="form-control" id="rho" value="1000" data-bs-toggle="tooltip" title="Density of the fluid (default: water)">
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="mu" class="form-label"><i class="fas fa-tachometer-alt"></i> Dynamic viscosity (Pa·s)</label>
                            <input type="number" step="0.0001" class="form-control" id="mu" value="0.001" data-bs-toggle="tooltip" title="Viscosity of the fluid (default: water)">
                        </div>
                    </div>
                </div>
                <div class="d-flex gap-2">
                    <button type="button" class="btn btn-primary flex-fill" onclick="calculate()"><i class="fas fa-calculator"></i> Calculate</button>
                    <button type="button" class="btn btn-secondary" onclick="resetForm()"><i class="fas fa-undo"></i> Reset</button>
                </div>
            </form>
            <div id="results" class="mt-4" style="display:none;">
                <h3><i class="fas fa-chart-bar"></i> Results</h3>
                <div class="result-box">
                    <div class="row">
                        <div class="col-md-6">
                            <p><strong>Velocity (V):</strong> <span id="V"></span></p>
                            <p><strong>Reynolds number (Re):</strong> <span id="Re"></span></p>
                            <p><strong>Friction factor (f):</strong> <span id="f"></span></p>
                        </div>
                        <div class="col-md-6">
                            <p><strong>Head loss (hf):</strong> <span id="hf"></span></p>
                            <p><strong>Pressure drop (ΔP):</strong> <span id="deltaP"></span></p>
                        </div>
                    </div>
                    <div id="warning" class="alert alert-warning mt-2" style="display:none;"></div>
                </div>
                <div class="chart-container mt-3">
                    <canvas id="resultsChart"></canvas>
                </div>
                <div class="d-flex gap-2 mt-3">
                    <button class="btn btn-success" onclick="saveCalculation()"><i class="fas fa-save"></i> Save Result</button>
                    <button class="btn btn-info" onclick="shareLink()"><i class="fas fa-share"></i> Share Link</button>
                </div>
            </div>
            <div id="history" class="mt-4" style="display:none;">
                <h3><i class="fas fa-history"></i> Calculation History</h3>
                <div class="history-table">
                    <table class="table table-striped">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Velocity (m/s)</th>
                                <th>Pressure Drop (Pa)</th>
                            </tr>
                        </thead>
                        <tbody id="historyBody"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
    <footer>
        <p>&copy; 2023 Pipe Hydraulics Calculator. Based on Darcy-Weisbach equation. For educational use.</p>
    </footer>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let chart;
        let history = JSON.parse(localStorage.getItem('calcHistory')) || [];

        function toggleAdvanced() {
            const adv = document.getElementById('advanced');
            const toggle = document.querySelector('.advanced-toggle i');
            adv.style.display = adv.style.display === 'none' ? 'block' : 'none';
            toggle.className = adv.style.display === 'none' ? 'fas fa-chevron-down' : 'fas fa-chevron-up';
        }

        function calculate() {
            const L = parseFloat(document.getElementById('L').value);
            const D = parseFloat(document.getElementById('D').value);
            const Q = parseFloat(document.getElementById('Q').value);
            const rho = parseFloat(document.getElementById('rho').value) || 1000;
            const mu = parseFloat(document.getElementById('mu').value) || 0.001;
            const g = 9.81;

            if (isNaN(L) || isNaN(D) || isNaN(Q) || L <= 0 || D <= 0 || Q <= 0) {
                alert('Please enter positive valid numbers for required fields.');
                return;
            }

            const A = Math.PI * (D / 2) ** 2;
            const V = Q / A;
            const Re = (rho * V * D) / mu;
            let warning = '';
            if (Re < 2100) warning = 'Warning: Laminar flow (Re < 2100). Formula may not apply accurately.';
            const f = 0.3164 / (Re ** 0.25);
            const hf = f * (L / D) * (V ** 2 / (2 * g));
            const deltaP = rho * g * hf;

            document.getElementById('V').textContent = V.toFixed(3) + ' m/s';
            document.getElementById('Re').textContent = Re.toFixed(0);
            document.getElementById('f').textContent = f.toFixed(4);
            document.getElementById('hf').textContent = hf.toFixed(3) + ' m';
            document.getElementById('deltaP').textContent = deltaP.toFixed(0) + ' Pa (' + (deltaP / 1000).toFixed(2) + ' kPa)';
            document.getElementById('warning').textContent = warning;
            document.getElementById('warning').style.display = warning ? 'block' : 'none';
            document.getElementById('results').style.display = 'block';

            // Update chart
            if (chart) chart.destroy();
            const ctx = document.getElementById('resultsChart').getContext('2d');
            chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: ['Velocity (m/s)', 'Head Loss (m)', 'Pressure Drop (kPa)'],
                    datasets: [{
                        label: 'Calculated Values',
                        data: [V, hf, deltaP / 1000],
                        backgroundColor: ['#007bff', '#28a745', '#dc3545'],
                    }]
                },
                options: { responsive: true, scales: { y: { beginAtZero: true } } }
            });
        }

        function resetForm() {
            document.getElementById('calcForm').reset();
            document.getElementById('results').style.display = 'none';
            document.getElementById('advanced').style.display = 'none';
            if (chart) chart.destroy();
        }

        function saveCalculation() {
            const result = {
                date: new Date().toLocaleString(),
                V: document.getElementById('V').textContent,
                deltaP: document.getElementById('deltaP').textContent
            };
            history.push(result);
            localStorage.setItem('calcHistory', JSON.stringify(history));
            updateHistory();
        }

        function updateHistory() {
            const tbody = document.getElementById('historyBody');
            tbody.innerHTML = '';
            history.forEach(item => {
                const row = `<tr><td>${item.date}</td><td>${item.V}</td><td>${item.deltaP}</td></tr>`;
                tbody.innerHTML += row;
            });
            document.getElementById('history').style.display = history.length ? 'block' : 'none';
        }

        function shareLink() {
            const params = new URLSearchParams({
                L: document.getElementById('L').value,
                D: document.getElementById('D').value,
                Q: document.getElementById('Q').value,
                rho: document.getElementById('rho').value,
                mu: document.getElementById('mu').value
            });
            const url = window.location.origin + window.location.pathname + '?' + params.toString();
            navigator.clipboard.writeText(url).then(() => alert('Link copied to clipboard!'));
        }

        // Load from URL params on page load
        window.onload = function() {
            const params = new URLSearchParams(window.location.search);
            ['L', 'D', 'Q', 'rho', 'mu'].forEach(id => {
                const val = params.get(id);
                if (val) document.getElementById(id).value = val;
            });
            updateHistory();
            // Initialize tooltips
            var tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'));
            tooltipTriggerList.map(function (tooltipTriggerEl) { return new bootstrap.Tooltip(tooltipTriggerEl); });
        };
    </script>
</body>
</html>
